<!DOCTYPE html>
<html lang="en">
    <head>
        <title>CitrixBleed Simulation</title>
        <link href="./main.css" rel="stylesheet">
    </head>
    <body onload="load_func()">
        <input placeholder="Username" type="text" id="username"/>
        <input placeholder="Password" type="password" id="password" />
        <button onclick="login()" class="button">LOGIN</button>
        <script src="./config.js"></script>
        <script>
            const ip = BACKEND_IP; //ip of the machine where the backend is gonna run
            function login(){
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;
                fetch(`http://${ip}:3000/doAuthentication`,
                    {
                        method: "POST",
                        headers: {"Content-Type":"application/json"},
                        body: JSON.stringify({
                            "username" : username,
                            "password" : password
                        })
                    }
                )
                .then( response => {
                    return response.json()
                })
                .then(data => {
                    console.log(data.message)
                    if(data.state === 1){
                        document.cookie = `session_id=${data.session_id}`
                        window.location.href = 'dashboard.html'
                    }
                })
                .catch(error => {
                    console.log(error)
                })
            }

            function load_func(){
                document.cookie.split(";").forEach((cookie) => {
                const name = cookie.split("=")[0].trim();
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;";
            });
            }
        </script>
    </body>
</html>
